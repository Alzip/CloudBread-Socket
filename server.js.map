{"version":3,"sources":["webpack:///webpack/bootstrap f31db5175ed7fb2610f8","webpack:///./src/config.js","webpack:///./src/core/redisClient.js","webpack:///./src/server.js","webpack:///external \"babel-polyfill\"","webpack:///external \"cors\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"redis\"","webpack:///external \"socket.io\"","webpack:///external \"socket.io-redis\""],"names":[],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap f31db5175ed7fb2610f8\n **/","export const {\n  REDIS_HOST,\n  REDIS_PORT,\n  REDIS_AUTH_KEY,\n} = process.env;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/config.js\n **/","import { REDIS_HOST, REDIS_AUTH_KEY, REDIS_PORT } from 'config';\nimport { createClient as createRedisClient } from 'redis';\n\nexport const canRedis = REDIS_HOST;\n\nexport const pubClient = canRedis ? createRedisClient({\n  host: REDIS_HOST,\n  port: REDIS_PORT,\n  auth_pass: REDIS_AUTH_KEY,\n}) : null;\n\nexport const subClient = canRedis ? createRedisClient({\n  host: REDIS_HOST,\n  port: REDIS_PORT,\n  auth_pass: REDIS_AUTH_KEY,\n  return_buffers: true,\n}) : null;\n\nconst redisClient = canRedis ? createRedisClient({\n  host: REDIS_HOST,\n  port: REDIS_PORT,\n  auth_pass: REDIS_AUTH_KEY,\n}) : null;\n\nexport function getRedisItem(id) {\n  return new Promise((resolve, reject) => {\n    redisClient.get(id, (error, res) => error ? reject(error) : resolve(res));\n  });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/redisClient.js\n **/","/* eslint no-console: 0, no-throw-literal: 0 */\nimport express from 'express';\nimport cors from 'cors';\nimport redisAdapter from 'socket.io-redis';\nimport {\n  subClient,\n  pubClient,\n  getRedisItem,\n  canRedis,\n} from 'core/redisClient';\n\nconst app = express();\nconst server = require('http').Server(app); // eslint-disable-line\nserver.listen(process.env.PORT || __PORT__, () => {\n  const { port } = server.address();\n  console.log(`The server is listening at http://localhost:${port}`);\n  if (__DEV__) {\n    console.log('__DEV_START__');\n  }\n});\n\napp.use(cors());\napp.get('*', (req, res) => {\n  res.status(200).send('Hello World');\n});\n\nexport default server;\n\n// it can be replaced DB\nconst channels = {};\nconst users = {};\n\nconst io = require('socket.io')(server);\n\nif (canRedis) {\n  io.adapter(redisAdapter({\n    pubClient,\n    subClient,\n  }));\n}\n\nio.on('connection', socket => {\n  const id = socket.client.id;\n\n  function use(route, callback) {\n    socket.on(route, (...args) => {\n      try {\n        callback(...args);\n      } catch (error) {\n        if (typeof(error) === 'string') {\n          socket.emit(`${route} error`, {\n            type: route,\n            message: error,\n          });\n        } else {\n          console.log(error);\n        }\n      }\n    });\n  }\n\n  // authorize user\n  use('authenticate user', async ({ token, username }) => {\n    if (canRedis) {\n      const userInfo = await getRedisItem(token);\n      if (!userInfo) throw 'Invalid token';\n    }\n    const user = users[id] = {\n      id,\n      username,\n      channels: [],\n    };\n    socket.emit('authorized', {\n      user,\n    });\n  });\n\n  // join channel\n  use('join channel', ({ link }) => {\n    const user = users[id];\n    if (!user) throw 'you should be authorized';\n    if (user.channels.indexOf(link) !== -1) throw 'already connected';\n    if (!channels[link]) {\n      channels[link] = {\n        link,\n        allUsers: 0,\n      };\n    }\n    const channel = channels[link];\n    user.channels.push(link);\n    channel.allUsers++;\n    socket.join(link);\n    socket.broadcast.to(link).emit('user joined', {\n      channel,\n      user,\n    });\n    socket.emit('channel connected', {\n      channel,\n    });\n  });\n\n  // leave channel\n  use('leave channel', ({ link }) => {\n    const user = users[id];\n    if (!user) throw 'you should be authorized';\n    if (user.channels.indexOf(link) === -1) throw 'not in connected';\n    const channel = channels[link];\n    if (!channel) throw 'the channel does not exist';\n    user.channels.splice(user.channels.indexOf(link), 1);\n    socket.emit('channel disconnected', { channel });\n    socket.broadcast.to(link).emit('user left', { channel, user });\n    socket.leave(link);\n    channel.allUsers -= 1;\n    if (!channel.allUsers) {\n      delete channels[link];\n    }\n  });\n\n  // send new message to users in the channel\n  use('new message', ({ link, content }) => {\n    const user = users[id];\n    if (!user) throw 'you should be authorized';\n    const channel = channels[link];\n    if (!channel) throw 'the channel does not exist';\n    if (user.channels.indexOf(link) === -1) throw 'you did not join the channel';\n    const message = {\n      author: id,\n      username: user.username,\n      content,\n    };\n    io.sockets.to(link).emit('new message', {\n      message,\n      channel,\n    });\n  });\n\n  // disconnected\n  socket.on('disconnect', () => {\n    const user = users[id];\n    if (!user) {\n      return;\n    }\n    user.channels.forEach(link => {\n      const channel = channels[link];\n      socket.broadcast.to(link).emit('user left', { channel, user });\n      channel.allUsers -= 1;\n      if (!channel.allUsers) {\n        delete channels[link];\n      }\n    });\n  });\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server.js\n **/","module.exports = require(\"babel-polyfill\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-polyfill\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"cors\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cors\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 7\n ** module chunks = 0\n **/","module.exports = require(\"redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redis\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"socket.io\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"socket.io-redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io-redis\"\n ** module id = 10\n ** module chunks = 0\n **/"],"sourceRoot":""}